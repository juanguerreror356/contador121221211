<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Case Counter Pro</title>
  <link rel="stylesheet" href="styles.css?v=pro-2025-08-10"/>
</head>
<body>
  <header class="topbar">
    <div class="topbar-left">
      <span id="appTitle">Contador</span>
      <button class="icon-btn auth-only agent-only" id="focusBtn" title="Modo Foco" aria-label="Modo Foco" hidden>ğŸ‘ï¸</button>
    </div>
    <div class="topbar-right">
      <span id="liveClock" class="clock auth-only" hidden>--:--:--</span>
    </div>
  </header>

  <main class="root">

    <!-- LOGIN -->
    <section id="loginView" class="view active tight">
      <div class="login-header mb6">
        <h1 class="title">Entrar</h1>
        <button id="helpBtn" class="help-btn" title="Ayuda" aria-label="Ayuda">â“</button>
      </div>

      <div class="row mb6">
        <button id="roleRep" class="btn toggle active">Representante</button>
        <button id="roleLeader" class="btn toggle">LÃ­der</button>
      </div>

      <div class="row mb6">
        <div class="mini-field">
          <label class="label">LÃ­der</label>
          <input id="leaderLdapInput" class="input" type="text" placeholder="ldapdelider"/>
        </div>
        <div class="mini-field" id="repFieldWrap">
          <label class="label">Tu LDAP</label>
          <input id="ldapInput" class="input" type="text" placeholder="tuusuario"/>
        </div>
      </div>

      <button id="loginBtn" class="btn primary full">Ingresar</button>
      <p id="loginError" class="error mt6" aria-live="polite"></p>
      <small class="muted">Validamos tu usuario y lÃ­der con la hoja <b>Usuarios</b>.</small>
    </section>

    <!-- PRINCIPAL (Representante) -->
    <section id="mainView" class="view">
      <div id="casesTab" class="tabpanel active">
        
        <!-- CORREGIDO: Input con Level Up como modificador -->
        <div class="card mb6">
          <label class="label">ID de caso</label>
          <div class="case-input-container" id="caseInputContainer">
            <input id="caseIdInput" class="input case-input" type="text" placeholder="NÃºmero de identificaciÃ³n"/>
            <button id="levelUpModifier" class="level-up-btn" title="Activar Level Up - Convierte caso normal en complejo" data-type="modifier">âœ¨</button>
          </div>
          <small class="muted">Ãšltimo: <span id="lastCaseId">â€”</span></small>
          
          <!-- NUEVO: Indicador Level Up activo -->
          <div id="levelUpIndicator" class="level-up-indicator" hidden>
            <div class="level-up-status">âœ¨ Level Up ACTIVO - El prÃ³ximo caso serÃ¡ complejo</div>
          </div>
        </div>

        <!-- NORMAL: Botones ON/OFF (ahora pueden ser Level Up) -->
        <div class="row">
          <button id="btnOn" class="btn action grow anim-on" data-type="on">
            <span class="btn-icon">â–·</span>
            <span class="btn-text">ON</span>
            <span class="btn-level-indicator" hidden>+ Level Up</span>
          </button>
          <button id="btnOff" class="btn action grow anim-off" data-type="off">
            <span class="btn-icon">âœ‰</span>
            <span class="btn-text">OFF</span>
            <span class="btn-level-indicator" hidden>+ Level Up</span>
          </button>
        </div>

        <div class="card mt6">
          <div class="row-between">
            <span class="muted">Meta Diaria</span>
            <span id="goalText" class="muted">0 / 50</span>
          </div>
          <div class="progress mt6">
            <span id="progressIcon" class="progress-icon" aria-hidden="true">ğŸš€</span>
            <div id="progressBar" class="progress-bar"></div>
          </div>

          <div id="goalInline" class="goal-inline" hidden>
            <input id="goalInputInline" class="input" type="number" min="1" step="1" />
            <div class="row">
              <button id="goalSaveInline" class="btn success grow">Guardar</button>
              <button id="goalCancelInline" class="btn ghost">Cancelar</button>
            </div>
          </div>
        </div>

        <div class="grid2 mt6">
          <div class="card">
            <h3 class="subtitle">Resumen</h3>
            <ul class="stats">
              <li>ON: <b id="statOn">0</b></li>
              <li>OFF: <b id="statOff">0</b></li>
              <li>Level Up: <b id="statLevel">0</b></li>
              <li>Total: <b id="statTotal">0</b></li>
            </ul>
            
            <!-- REUBICADO: Rachas debajo del resumen -->
            <div class="streak-mini-relocated mt6" id="streakMiniRelocated">
              <div class="streak-mini-content">
                <span class="streak-mini-icon">ğŸ”¥</span>
                <span id="streakDays">0</span>
                <span class="streak-mini-label">dÃ­as seguidos</span>
                <span class="streak-mini-record">(rÃ©cord: <span id="streakBest">0</span>)</span>
              </div>
            </div>
          </div>
          
          <div class="card">
            <h3 class="subtitle">Mi PosiciÃ³n</h3>
            <div id="miniRanking" class="mini-ranking-container"></div>
            
            <!-- CORREGIDO: MÃ©trica de Ãºltima hora -->
            <div id="realtimeMetrics" class="realtime-metrics mt6">
              <div class="metric-item">
                <span class="metric-label">Ãšltima hora (<span id="currentHourRange">--</span>):</span>
                <span id="lastHourCases" class="metric-value">0 casos</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Total equipo:</span>
                <span id="teamTotal" class="metric-value">0 (<span id="myParticipation">0%</span>)</span>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt6">
          <button id="undoBtn" class="btn ghost">-1</button>
          <button id="editGoalBtn" class="btn success grow">Modificar Meta</button>
        </div>

        <div class="row mt6">
          <button class="icon-btn bottom-nav" id="achievementsBtn" title="Logros">ğŸ–ï¸</button>
          <button class="icon-btn bottom-nav" id="rankingBtn" title="Ranking">ğŸ†</button>
          <button class="icon-btn bottom-nav" id="settingsBtn" title="ConfiguraciÃ³n">âš™ï¸</button>
          <button class="btn outline grow" id="historyBtn" title="Ver historial completo">ğŸ“Š Historial</button>
        </div>
      </div>
    </section>

    <!-- RANKING -->
    <section id="rankingView" class="view">
      <div class="navrow">
        <button class="icon-btn" data-back="main">â†</button>
        <h2 class="title">Ranking del Equipo</h2>
      </div>
      <div id="motivationalMessage" class="motivational-card mb6">
        <div class="motivation-text">Â¡Sigue asÃ­! ğŸ’ª</div>
      </div>
      <div id="rankingList" class="rank-list"></div>
    </section>

    <!-- CONFIGURACIÃ“N -->
    <section id="settingsView" class="view">
      <div class="navrow">
        <button class="icon-btn" data-back="main">â†</button>
        <h2 class="title">ConfiguraciÃ³n</h2>
        <button id="openPalettes" class="icon-btn" title="Paletas">ğŸ¨</button>
      </div>

      <div id="themeCard" class="card">
        <h3 class="subtitle">Paletas (color o animaciÃ³n)</h3>
        <div id="themePicker" class="theme-grid fancy">
          <button class="swatch fancy" data-theme="purple"   style="--c:#8A2BE2">ğŸŒŒ</button><span>Noche PÃºrpura</span>
          <button class="swatch fancy" data-theme="mint"     style="--c:#1DBA8E">ğŸƒ</button><span>Menta Fresca</span>
          <button class="swatch fancy" data-theme="sunset"   style="--c:#FF7A18">ğŸŒ‡</button><span>Atardecer</span>
          <button class="swatch fancy" data-theme="ocean"    style="--c:#1E88E5">ğŸŒŠ</button><span>OcÃ©ano</span>
          <button class="swatch fancy" data-theme="pink"     style="--c:#EC4899">ğŸŒ¸</button><span>Rosa</span>
          <button class="swatch fancy" data-anim="ambitious"    style="--c:#16a34a">ğŸš€</button><span>Ambicioso</span>
          <button class="swatch fancy" data-anim="productivity" style="--c:#0ea5e9">â˜•</button><span>Productividad</span>
          <button class="swatch fancy" data-anim="magic"        style="--c:#7c3aed">âœ¨</button><span>MÃ¡gico</span>
          <button class="swatch fancy" data-anim="classic"      style="--c:#f59e0b">ğŸ“ˆ</button><span>ClÃ¡sico</span>
        </div>
      </div>

      <div class="card">
        <h3 class="subtitle">Personalizar tono</h3>
        <div class="row">
          <input id="customColor" class="input range-color" type="color" value="#1DBA8E" title="Color primario"/>
          <button id="resetThemeBtn" class="btn ghost">Reset</button>
        </div>
        <small class="muted">Elige un color y lo aplicamos al tema actual.</small>
        
        <button id="extensionSettingsBtn" class="btn outline full mt6">
          âŒ¨ï¸ Atajos de Teclado
        </button>
        <small class="muted">Configura shortcuts para registrar casos mÃ¡s rÃ¡pido.</small>
      </div>

      <button id="logoutBtn" class="btn danger full mt6">Cerrar SesiÃ³n</button>
    </section>

    <!-- LOGROS CORREGIDOS -->
    <section id="achievementsView" class="view">
      <div class="navrow">
        <button class="icon-btn" data-back="main">â†</button>
        <h2 class="title">Logros</h2>
        <div class="achievement-progress">
          <span id="achievementCount">0/12</span>
        </div>
      </div>
      
      <div class="achievement-categories">
        <!-- Casos ON -->
        <div class="achievement-category">
          <h3 class="category-title">ğŸ“ Casos ON</h3>
          <div id="achievementsOn" class="achievements-grid">
            <!-- Se generan dinÃ¡micamente con rangos 50-100-200-250 -->
          </div>
        </div>
        
        <!-- Casos OFF -->
        <div class="achievement-category">
          <h3 class="category-title">âœ‰ï¸ Casos OFF</h3>
          <div id="achievementsOff" class="achievements-grid">
            <!-- Se generan dinÃ¡micamente con rangos 50-100-200-250 -->
          </div>
        </div>
        
        <!-- Level Up -->
        <div class="achievement-category">
          <h3 class="category-title">âœ¨ Level Up</h3>
          <div id="achievementsLevel" class="achievements-grid">
            <!-- Se generan dinÃ¡micamente -->
          </div>
        </div>
        
        <!-- Consistencia -->
        <div class="achievement-category">
          <h3 class="category-title">ğŸ”¥ Consistencia</h3>
          <div id="achievementsStreak" class="achievements-grid">
            <!-- Se generan dinÃ¡micamente -->
          </div>
        </div>
      </div>
    </section>

    <!-- HISTORIAL CON ESTADÃSTICAS -->
    <section id="historyView" class="view">
      <div class="navrow">
        <button class="icon-btn" data-back="main">â†</button>
        <h2 class="title">Historial Completo</h2>
        <button id="historyFilters" class="icon-btn" title="Filtros">ğŸ”</button>
      </div>
      
      <div class="filters-bar mb6" id="historyFiltersBar" hidden>
        <div class="row">
          <input id="historyDate" class="input" type="date"/>
          <select id="historyType" class="input">
            <option value="">Todos los tipos</option>
            <option value="on">ON â–·</option>
            <option value="off">OFF âœ‰</option>
            <option value="level">Level Up âœ¨</option>
          </select>
          <button id="clearHistoryFilters" class="btn ghost">Limpiar</button>
        </div>
      </div>

      <!-- NUEVO: BotÃ³n de estadÃ­sticas semanales -->
      <div class="row mb6">
        <button id="weeklyStatsBtn" class="btn outline grow">ğŸ“Š Ver estadÃ­sticas 7 dÃ­as</button>
      </div>

      <!-- NUEVO: Panel de estadÃ­sticas semanales -->
      <div id="weeklyStatsPanel" class="weekly-stats-panel mb6" hidden>
        <div class="card">
          <div class="row-between">
            <span class="subtitle">Ãšltimos 7 dÃ­as</span>
            <span class="muted" id="weeklyTotal">0 casos</span>
            <button id="closeWeeklyStats" class="icon-btn">âœ–</button>
          </div>
          <div class="weekly-chart mt6" id="weeklyChart">
            <!-- Se genera dinÃ¡micamente -->
          </div>
        </div>
      </div>
      
      <div class="grid2 mb6">
        <div class="card">
          <div class="stats-grid">
            <div class="stat-item"><div class="stat-num" id="histStatsOn">0</div><div class="stat-label">â–· ON</div></div>
            <div class="stat-item"><div class="stat-num" id="histStatsOff">0</div><div class="stat-label">âœ‰ OFF</div></div>
            <div class="stat-item"><div class="stat-num" id="histStatsLevel">0</div><div class="stat-label">âœ¨ Level</div></div>
            <div class="stat-item"><div class="stat-num" id="histStatsTotal">0</div><div class="stat-label">ğŸ“Š Total</div></div>
          </div>
        </div>
        <div class="card">
          <h3 class="subtitle">Resumen</h3>
          <div class="muted">Periodo: <span id="histStatsPeriod">Hoy</span></div>
          <div class="muted">Promedio: <span id="histStatsAvg">â€”</span> casos/h</div>
        </div>
      </div>
      
      <div id="historyList" class="history-list"></div>
    </section>

    <!-- FOCO -->
    <section id="focusView" class="view focus tight agent-only">
      <div class="navrow">
        <button class="icon-btn" id="focusBackBtn">â†</button>
        <h2 class="title">Modo Foco</h2>
      </div>
      <div class="card mb6">
        <label class="label">ID de caso</label>
        <div class="case-input-container">
          <input id="focusCaseId" class="input case-input big" type="text" placeholder="Ingresa ID y registra"/>
          <button id="focusLevelUpModifier" class="level-up-btn level-up-focus" title="Level Up" data-type="modifier">âœ¨</button>
        </div>
        <small class="muted">Ãšltimo: <span id="lastCaseIdFocus">â€”</span></small>
      </div>
      <div class="row">
        <button id="focusOn" class="btn action grow anim-on" data-type="on">â–· ON</button>
        <button id="focusOff" class="btn action grow anim-off" data-type="off">âœ‰ OFF</button>
      </div>

      <div class="progress big mt6 clamp-end">
        <span id="focusProgressIcon" class="progress-icon">ğŸš€</span>
        <div id="focusProgress" class="progress-bar"></div>
      </div>
      <div class="giant mt6" id="focusTotal">0</div>
    </section>

    <!-- PANEL DEL LÃDER HÃBRIDO REDISEÃ‘ADO -->
    <section id="leaderView" class="view leader-only">
      <div class="navrow leader-only">
        <h2 class="title">ğŸ† Panel del LÃ­der</h2>
      </div>

      <!-- NUEVO: Dashboard HÃ­brido -->
      <div class="leader-dashboard-hybrid">
        
        <!-- Header Stats -->
        <div class="leader-header-stats mb6">
          <div class="header-stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <div class="stat-info">
              <div class="stat-number" id="leaderTotalCases">0</div>
              <div class="stat-label">casos hoy</div>
              <div class="stat-trend" id="leaderTrendDaily">--</div>
            </div>
          </div>
          
          <div class="header-stat-card">
            <div class="stat-icon">ğŸ¯</div>
            <div class="stat-info">
              <div class="stat-number" id="leaderGoalPercent">0%</div>
              <div class="stat-label">meta global</div>
              <div class="stat-trend" id="leaderTrendGoal">--</div>
            </div>
          </div>
          
          <div class="header-stat-card">
            <div class="stat-icon">â­</div>
            <div class="stat-info">
              <div class="stat-number" id="leaderTopPerformer">--</div>
              <div class="stat-label">top performer</div>
              <div class="stat-trend" id="leaderTopCases">0 casos</div>
            </div>
          </div>
          
          <div class="header-stat-card">
            <div class="stat-icon">ğŸ”¥</div>
            <div class="stat-info">
              <div class="stat-number" id="leaderActiveCount">0</div>
              <div class="stat-label">activos</div>
              <div class="stat-trend" id="leaderInactiveCount">0 inactivos</div>
            </div>
          </div>
        </div>

        <!-- Live Ranking -->
        <div class="card leader-ranking-live mb6">
          <div class="card-header">
            <h3 class="subtitle">ğŸ† Ranking en Vivo</h3>
            <span class="live-indicator">ğŸ”´ EN VIVO</span>
          </div>
          
          <div id="leaderLiveRanking" class="live-ranking-list">
            <!-- Se genera dinÃ¡micamente -->
          </div>
        </div>

        <!-- Insights Panel -->
        <div class="card leader-insights">
          <div class="card-header">
            <h3 class="subtitle">ğŸ’¡ Insights AutomÃ¡ticos</h3>
          </div>
          
          <div id="leaderInsights" class="insights-list">
            <!-- Se generan dinÃ¡micamente -->
          </div>
        </div>

      </div>
    </section>
  </main>

  <!-- HOSTS DE NOTIFICACIONES -->
  <div id="toastHost" class="toast-host" aria-live="polite" aria-atomic="true"></div>
  <div id="floatHost" class="float-host" aria-hidden="true"></div>

  <!-- MODAL DE AYUDA ACTUALIZADO -->
  <div id="helpModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Â¿CÃ³mo funciona Case Counter Pro?</h3>
        <button id="helpClose" class="icon-btn">âœ–</button>
      </div>
      <div class="modal-body">
        <h4>ğŸ“‹ Registro de Casos</h4>
        <p>â€¢ <strong>â–· ON</strong>: Casos de chat/llamada en tiempo real</p>
        <p>â€¢ <strong>âœ‰ OFF</strong>: Casos offline (emails, investigaciones)</p>
        
        <h4>âœ¨ Level Up (NUEVO)</h4>
        <p>â€¢ <strong>Modificador de complejidad</strong>: No es tipo de caso</p>
        <p>â€¢ Activa âœ¨ y luego presiona ON u OFF</p>
        <p>â€¢ Convierte casos normales en "ON/Level Up" o "OFF/Level Up"</p>
        
        <h4>ğŸ¯ Metas y Ranking</h4>
        <p>â€¢ Tu meta diaria se actualiza automÃ¡ticamente</p>
        <p>â€¢ Compites en tiempo real con tu equipo</p>
        <p>â€¢ El ranking se actualiza cada 5 segundos</p>
        
        <h4>ğŸ”¥ Sistema de Rachas</h4>
        <p>â€¢ MantÃ©n rachas cumpliendo tu meta diariamente</p>
        <p>â€¢ Se muestra debajo del resumen de casos</p>
        <p>â€¢ Ve tu participaciÃ³n en el total del equipo</p>
        
        <h4>â° MÃ©tricas en Tiempo Real</h4>
        <p>â€¢ <strong>Ãšltima hora</strong>: Muestra rango actual (ej: 14:00-15:00)</p>
        <p>â€¢ <strong>Total equipo</strong>: Tu porcentaje de participaciÃ³n</p>
        
        <h4>ğŸ† Logros Actualizados</h4>
        <p>â€¢ <strong>Rangos ON/OFF</strong>: 50, 100, 200, 250 casos</p>
        <p>â€¢ Progreso visual con efectos especiales</p>
        <p>â€¢ Desbloqueos automÃ¡ticos por rendimiento</p>
      </div>
      <button id="helpOk" class="btn primary full">Entendido</button>
    </div>
  </div>

  <script src="popup.js?v=2.5.0"></script>
</body>
</html>
